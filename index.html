<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Blurry vs Clear Document Classifier</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            margin: 40px;
        }

        img {
            max-width: 320px;
            margin-top: 16px;
            border: 1px solid #ddd;
        }

        .result {
            font-size: 18px;
            margin-top: 18px;
        }
    </style>
</head>

<body>
    <h1>Document Quality Checker</h1>
    <p>Upload a document image to check if it needs retake.</p>
    <input type="file" id="imageUpload" accept="image/*" />
    <br>
    <img id="preview" />
    <div class="result" id="result"></div>

    <script>
  const URL = "./model/";
  let model;

  const resultEl = document.getElementById("result");
  resultEl.innerText = "Loading model...";

  (async () => {
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    resultEl.innerText = "Model loaded. Upload an image.";
  })();

  document.getElementById("imageUpload").addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      const img = document.getElementById("preview");
      img.src = reader.result;

      img.onload = async () => {
        resultEl.innerText = "Running prediction...";

        const preds = await model.predict(img);
        let best = preds.reduce((a,b) => (b.probability > a.probability ? b : a));

        resultEl.innerHTML =
          `Prediction: <b>${best.className}</b><br>Confidence: ${(best.probability*100).toFixed(2)}%`;
      };
    };
    reader.readAsDataURL(file);
  });
</script>
</body>

</html>  
